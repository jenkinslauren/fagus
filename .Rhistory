install.packages('Rcpp')
install.packages('devtools')
install.packages('Rdpack')
rm(list=ls())
library(raster)
library(rgeos)
library(enmSdm)
library(gtools)
library(spatialEco)
library(stats)
library(maps)
library(rnaturalearth)
library(cowplot)
library(ggrepel)
library(RColorBrewer)
colors <- c('#d73027','#f46d43','#fdae61','#fee08b','#ffffbf','#d9ef8b','#a6d96a','#66bd63','#1a9850')
genus <- 'fagus'
setwd(paste0('/Volumes/lj_mac_22/MOBOT/by_genus/', genus))
gcmList <- c('hadley', 'ccsm', 'ecbilt')
pc <- 5
climYears <- seq(21000, 0, by=-1000)
world <- ne_countries(scale = "medium", returnclass = "sf")
world <- as(world, "Spatial")
pollenFileName <- paste0('/Volumes/lj_mac_22/pollen/predictions-',
toupper(genus),
'_meanpred_iceMask.tif')
pollenRast <- stack(pollenFileName)
names(pollenRast) <- c(paste0("Fraxinus_pollen_predictions_", 0:21, "kybp"))
pollenRast <- unstack(pollenRast)
pollenRast <- stack(rev(pollenRast))
load('/Volumes/lj_mac_22/MOBOT/by_genus/study_region/Study Region Extent.Rdata')
gcm <- 'hadley'
folder <- '/Volumes/lj_mac_22/MOBOT/by_genus/env_data/hadley/tifs/BIO1'
for(yr in climYears) plot(brick(paste0(folder, '/BIO1_', yr, '.tif')))
for(yr in climYears) plot(brick(paste0(folder, '/BIO1_', yr, 'ybp.tif')))
for(yr in climYears) plot(brick(paste0(folder, '/BIO1_', yr, 'ybp.tif')), main = paste0(yr, ' YBP'))
for(yr in climYears) plot(crop(brick(paste0(folder, '/BIO1_', yr, 'ybp.tif')), studyExtent), main = paste0(yr, ' YBP'))
pdf(file = '/Volumes/lj_mac_22/MOBOT/by_genus/env_data/hadley/env_rasters.pdf', width = 11, height = 8.5)
for(yr in climYears) plot(crop(brick(paste0(folder, '/BIO1_', yr, 'ybp.tif')), studyExtent), main = paste0(yr, ' YBP'))
dev.off()
genus <- 'fagus'
studyRegionFileName <- paste0('./pollen/predictions-',
toupper(genus), '_meanpred_iceMask.tif')
studyRegionRasts <- brick(studyRegionFileName)
par(mfrow=c(2,2))
plot(studyRegionRasts)
baseFolder <- '/Volumes/lj_mac_22/MOBOT/by_genus/'
# load climate for given gcm
load(paste0(baseFolder, 'env_data/', gcm, '/PCA_climate_rasters_pc', pc, '.Rdata'))
load(paste0(baseFolder, 'env_data/', gcm, '/PCA_prcomp_pc', pc, '.Rdata'))
if(exists('lorenz')) {
clim <- lorenz
rm(lorenz)
}
climYear <- 0
# set constants for given gcm
fileName <- paste0(baseFolder, 'env_data/', gcm, '/clipped_data/envDataClipped_',
climYear, 'YBP_pc', pc, '.tif')
vars <- names(clim[[1]])
if(gcm == 'hadley') {
land <- raster(paste0(baseFolder, 'env_data/', gcm, '/tifs/',
vars[1], '/', vars[1],
'_', climYear, 'ybp.tif'))
} else if (gcm == 'ccsm' | gcm == 'ecbilt') {
land <- raster(paste0(baseFolder, 'env_data/', gcm,
'/tifs/', climYear, 'BP/', vars[1], '.tif'))
}
plot(land)
pcPrediction <- list()
for (i in 1:length(clim)) { # label each env layer by variable name and year
names(clim[[i]]) <- vars
pcPrediction[i] <- raster::predict(clim[[i]], pca, index = 1:pc)
names(pcPrediction[[i]]) <- paste0("pc", 1:pc, "_", (i-1)*1000, "KYBP")
}
envDataPca <- stack(pcPrediction)
plot(envDataPca)
envYr <- pcPrediction[[(climYear/1000) + 1]] # keep only the PCA rasters for given climate year
pcPrediction[[1]]
plot(pcPrediction[[1]])
names(envYr) <- paste0('pca', 1:pc) # label layers by pc
envDataClipped <- list()
nlayers(envYr)
n <- 1
x <- envYr[[n]]
plot(x)
x
x <- crop(x, extent(studyRegionRasts[[(climYear/1000) + 1]]))
projection(x) <- getCRS("WGS84")
plot(x)
plot(studyRegionRasts[[(climYear/1000) + 1]])
x <- crop(x, studyRegionRasts[[(climYear/1000) + 1]])
plot(x)
par(mfrow=c(1,1))
studyRegionRasts[[(climYear/1000) + 1]]
projection(studyRegionRasts[[(climYear/1000) + 1]]) <- getCRS('WGS84')
projection(studyRegionRasts)
projection(studyRegionRasts) <- getCRS('WGS84')
x <- raster::crop(x, extent(studyRegionRasts[[(climYear/1000) + 1]]))
plot(x)
extent(studyRegionRasts[[(climYear/1000) + 1]])
extent(X)
extent(x)
projection(x)
projection(studyRegionRasts)
x <- crop(x, extent(studyRegionRasts[[(climYear/1000) + 1]]))
plot(x)
plot(studyRegionRasts)
extent(x)
plot(projectRaster(x, extent(studyRegionRasts)))
plot(crop(x, studyRegionRasts))
plot(crop(x, studyExtent))
